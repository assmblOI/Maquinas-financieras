import pandas as pd
import matplotlib.pyplot as plt
from io import BytesIO
import base64

# --- 1. Datos para J.C. s ---
years = [3, 5, 10, 15, 20]
monthly_premium = 700
annual_premium = monthly_premium * 12

policy_values = {3: 16382, 5: 30001, 10: 68631, 15: 106034, 20: 163822}

def calculate_fv(annual_p, rate, year):
    if rate == 0: return annual_p * year
    return annual_p * (((1 + rate) ** year - 1) / rate)

data = {
    'Año': years,
    'Total Pagado ($)': [annual_premium * y for y in years],
    'Póliza J.C. s ($)': [policy_values[y] for y in years],
    'Ahorros 1% ($)': [int(calculate_fv(annual_premium, 0.01, y)) for y in years],
    'Bonos 5% ($)': [int(calculate_fv(annual_premium, 0.05, y)) for y in years]
}
df = pd.DataFrame(data)

# --- 2. Gráfico Optimizado ---
plt.figure(figsize=(10, 6))
plt.plot(df['Año'], df['Póliza J.C. s ($)'], marker='o', linewidth=3, color='#2c3e50', label='Póliza')
plt.plot(df['Año'], df['Ahorros 1% ($)'], marker='s', linestyle='--', color='#e67e22', label='Ahorros (1%)')
plt.plot(df['Año'], df['Bonos 5% ($)'], marker='^', linestyle='-.', color='#27ae60', label='Bonos (5%)')
plt.plot(df['Año'], df['Total Pagado ($)'], color='gray', linestyle=':', alpha=0.6, label='Costo Total')

plt.title('Proyección Financiera J.C. s', fontsize=14)
plt.xlabel('Años', fontsize=12)
plt.ylabel('Valor ($)', fontsize=12)
plt.grid(True, linestyle='--', alpha=0.5)
plt.legend()
plt.xticks(years)

buffer = BytesIO()
plt.savefig(buffer, format='png', bbox_inches='tight')
buffer.seek(0)
image_base64 = base64.b64encode(buffer.getvalue()).decode('utf-8')
buffer.close()

# --- 3. HTML con Diseño Responsivo (Mobile-First) ---
html_content = f"""
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Móvil J.C. s</title>
    <style>
        body {{ 
            font-family: sans-serif; 
            margin: 0; 
            padding: 10px; 
            background-color: #f4f7f6; 
            color: #333; 
        }}
        .container {{ 
            max-width: 100%; 
            margin: 0 auto; 
            background: white; 
            padding: 15px; 
            border-radius: 10px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }}
        h1 {{ font-size: 1.4rem; text-align: center; color: #2c3e50; }}
        .chart-box {{ text-align: center; margin: 15px 0; }}
        img {{ width: 100%; height: auto; border-radius: 5px; }}
        
        /* Contenedor con scroll para la tabla en móviles */
        .table-scroll {{
            width: 100%;
            overflow-x: auto;
            margin-top: 20px;
            border: 1px solid #ddd;
        }}
        table {{ 
            width: 100%; 
            border-collapse: collapse; 
            min-width: 500px; /* Evita que los números se amontonen */
            font-size: 0.9rem;
        }}
        th, td {{ padding: 10px; text-align: right; border-bottom: 1px solid #eee; }}
        th {{ background-color: #2c3e50; color: white; }}
        
        .note {{ 
            font-size: 0.85rem; 
            background: #e8f4f1; 
            padding: 10px; 
            border-radius: 5px; 
            margin-top: 20px; 
            line-height: 1.4;
        }}
    </style>
</head>
<body>
    <div class="container">
        <h1>Proyección para J.C. s</h1>
        
        <div class="chart-box">
            <img src="data:image/png;base64,{image_base64}" alt="Gráfico">
        </div>

        <h3>Tabla de Datos</h3>
        <p style="font-size: 0.8rem; color: #666;">(Desliza la tabla hacia los lados para ver más)</p>
        
        <div class="table-scroll">
            {df.to_html(index=False, border=0)}
        </div>

        <div class="note">
            <strong>Resumen:</strong> La póliza de J.C. s alcanza su punto de eficiencia tras el año 10, superando el ahorro tradicional y ofreciendo beneficios fiscales que no se reflejan en el gráfico.
        </div>
    </div>
</body>
</html>
"""

with open("proyeccion_movil_JCs.html", "w", encoding="utf-8") as f:
    f.write(html_content)

print("¡Hecho! Abre 'proyeccion_movil_JCs.html' en tu Android.")

